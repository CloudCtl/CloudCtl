#!/bin/bash

# Update repo with latest from master
git_pull () {
    cd /root/koffer;
    git pull;
}

# Start Registry Server
run_registry () {
  /usr/bin/run_registry.sh
}

run_core () {
git_pull 2>&1 1>/dev/null
run_registry 2>&1 1>/dev/null
}

run () {
clear
run_core
time ./site.yml
sleep 2
bundleDu="$(du -h /root/deploy/bundle/koffer-bundle.openshift-*.tar | awk '{print $1}' | head -n 1)"
bundlePath="$(ls /root/deploy/bundle/koffer-bundle.openshift-*.tar | head -n 1 | sed 's/root\/deploy/tmp/')"
cat <<EOF

  Koffer Bundle Complete: ${bundleDu} ${bundlePath}

EOF
}
run
